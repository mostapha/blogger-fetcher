/*
BloggerFetcher (v1.0)
https://github.com/mostapha/blogger-fetcher
Copyright (c) 2023 Mustapha Bouh
Licensed under the MIT license
*/
!function(){"use strict";const e=e=>"string"==typeof e,t=e=>"function"==typeof e,r=e=>{console.warn(e)},a=()=>{},n=["summary","full"],l=e=>e.responseText&&e.responseText.includes("is not enabled"),s={alt:"json",redirect:"false","max-results":8},i=e=>!isNaN(e),u=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:[+-]\d{2}:\d{2}|Z)?$/,o=e=>!!u.test(e)||(r('invalid iso8601: "'+e+'"'),!1),d=e=>""!==e.trim(),m=e=>'label:"'+e+'"',c=e=>'-label:"'+e+'"',p=/\/(s72-c)\/|=(s72-w\d+-h\d+-c)$/,f=/<img[^>]+src="([^">]+)"/,h=e=>function(t,r){return r?"/"+e+"/":"="+e},y=e=>{const t=e[0],r=(e=>void 0===e.uri)(t);return r?null:{name:t.name.$t,profileUrl:t.uri.$t,imageUrl:t.gd$image.src}},b=e=>(e=>g(e).map(w))(e),g=e=>"0"!==e.feed.openSearch$totalResults.$t?e.feed.entry:[],$=e=>{return e.summary?e.summary.$t.trim():e.content?(t=e.content.$t,r=document.createElement("span"),r.innerHTML=t,a=r.textContent||r.innerText,a.substring(0,400)).trim():"";var t,r,a},x=e=>e.media$thumbnail?(e=>{const t=e.url;return{original:t,small:t.replace(p,h("w300")),medium:t.replace(p,h("w600")),large:t.replace(p,h("w1200"))}})(e.media$thumbnail):e.content?(e=>{const t=e.$t.match(f);if(t){const e=t[1];return{original:e,small:e,medium:e,large:e}}return null})(e.content):null,w=e=>{return{id:(n=e.id.$t,n.match(/\d+$/)[0]),published:e.published.$t,updated:e.updated.$t,labels:(a=e.category,a?a.map((e=>e.term)):[]),title:e.title.$t,summary:$(e),url:(r=e.link,r.filter((e=>"alternate"===e.rel))[0].href),author:y(e.author),image:x(e),commentsCount:(t=e.thr$total,t?Number(t.$t):null)};var t,r,a,n};!function(){const u={VERSION:"1.0",getPosts(u,p){u||(u={}),p&&t(p)||(p=a),((e,t,r)=>{var a;((e,t)=>{jQuery.ajax({cache:!0,url:e}).done((e=>{t(!0,e)})).fail((function(e,r){let a="unknown";4===e.readyState?a=l(e)?"disabled-blog-feed":"http-error":0===e.readyState&&(a="network-error"),t(!1,a)}))})("/feeds/posts/"+((a=r.feed)&&n.includes(a)?a:"summary")+"/?"+(e=>{let t="";for(var r in e)""!==t&&(t+="&"),t+=r+"="+encodeURIComponent(e[r]);return t})(e),t)})((({label:t,labels:a,superCates:n,maxResults:l,startIndex:u,updatedMin:p,updatedMax:f,publishedMin:h,publishedMax:y})=>{let b={};if(n){if(Array.isArray(n)&&n.length>0){const[t,a,l]=n;let s=[];t&&(t&&Array.isArray(t)&&t.length>0?s=t.filter(d):e(t)&&s.push(t));let i=[];a&&Array.isArray(a)&&(a.length>1?i=a.filter(d):r("selectiveCates takes at least 2 cates"));let u=[];l&&(Array.isArray(l)?u=l.filter(d):e(l)&&u.push(l));let o=s.map(m).join(" "),p=i.map(m).join("|"),f=u.map(c).join(" "),h="";""!==o&&(h+=o),""!==p&&(h+=" ("+p+")"),""!==f&&(h+=" "+f),""!==h&&(b.q=h.trim())}}else if(t){if(!e(t))throw"label value must be a string";b.category=t+""}else if(a){if(!Array.isArray(a))throw"labels value must be an array";{let e=a.filter(d).map(m).join(" ");""!==e&&(b.q=e)}}return l&&i(l)&&l>=0&&(b["max-results"]=l),u&&i(u)&&u>=1&&(b["start-index"]=u),p&&o(p)&&(b["updated-min"]=p),f&&o(f)&&(b["updated-max"]=f),h&&o(h)&&(b["published-min"]=h),y&&o(y)&&(b["published-max"]=y),Object.assign({},s,b)})(u),((e,t)=>{e||console.error(t),p({success:e,data:e?b(t):t})}),{feed:u.feed})},from(e,r){r&&t(r)&&r({success:!0,data:b(e)})}};window.BloggerFetcher=u}()}();